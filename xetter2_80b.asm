;
;  XETTER 2
;     for MZ-80B
;
; May 6, 1985
;     by K.Kuromusha
;
 OFFSET $2260
 START  $12A0
;
;Object ƒ $3500~
;
GAMEN EQU GAMN+41
;
 GOTO START
;
GC    [HL [BC
 !VOP
 (GCA+1)=SP SP=$FF40 HL=0
 DO B=200
 !(E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5)
 UNTIL DEC(B)=0
GCA   SP=0
 !VCL
 ]BC ]HL
 RET
;
VC    [HL [BC
 !VOP
 (VCA+1)=SP SP=$D3E8 HL=0
 DO B=25
 !(E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5)
 UNTIL DEC(B)=0
VCA   SP=0
 !VCL
 ]BC ]HL
 RET
;
VOP   [AF
 A=$80
 PORT($E8)=A
 ]AF RET
;
VCL   [AF
 A=0
 PORT($E8)=A
 ]AF RET
;
SHOKI !$0CEE  ;CHR40
 A=0
 PORT($E8)=A
 A=2
 PORT($F4)=A
 A=1 HL=$000B
 (HL+)=A
 A=$18
 (HL)=A
 !$08D3
 HL=$11D0
 A=$12
 (HL)=A
 PORT($E0)=A
 !GC !VC
 HL=0 (HI)=HL
 A=7 !$0E50  ;TEMPO
 A=0 ($1039)=A  ;Don't stop MUSIC
 !DCLR
 RET
;
DCLR   (SSP+1)=SP SP=END+$B98C
 HL=$2020 DO B=190
 !(E5E5E5E5E5E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5E5E5E5E5E5)
 UNTIL DEC(B)=0
 (SHL+1)=SP
SSP   SP=0
SHL   HL=0 DE=190
 DO B=150
 (HL)="6"
 HL=HL+DE
 UNTIL DEC(B)=0
 RET
;
BACK  A=101 (MEN)=A GOTO L1
;
 DEFS 80
;
START SP=START
 !SHOKI
L0    !DEMO
L1    A=(CONST)
 B=A A=(MEN)
 IF B<>0 THEN IF A=251 GOTO BACK
 IF B=0 THEN IF A=101 GOTO CLEAR
 !S3
LOOP  !IMOVE
 !SSC
 A=(BOM)
 IF A=1 GOTO BOMY
 A=(CLR)
 IF A=0 GOTO CLR1
 !EMOVE
 A=(BOM)
 IF A=1 GOTO BOMY0
 !YMOVE
 HL=(TIME)
 HL-
 (TIME)=HL
 !SSC
 A=(BOM)
 IF A=1 GOTO BOMY
 HL=(TIME)
 IF HL=0 GOTO BOMY
 GOTO LOOP
;
SC    DEFS 2
HI    DEFS 2
BOM   DEFS 1
CLR   DEFS 1
MEN   DEFS 1
MY    DEFS 1
ED    DEFS 1
;
DEM0  !(""0D)
DEM1  !("              "0D)
DEM2  !("                                "0D)
DEM3  !("                         "0D)
DEM4  !("                                "0D)
DEM5  !("                       "0D)
DEM6  !("                  "0D)
DEM7  !("         "0D)
DEM8  !("                         "0D)
;
DE0   !(""0D)
DE1   !("        Programed by K.Kuromusha        "0D)
DE2   !(""0D)
DE3   !("     Push 1 or 2 or 3 key.              "0D)
DE4   !("             1. ORIGINAL GAME           "0D)
DE5   !("             2. CONSTRUCTION GAME       "0D)
DE6   !("             3. CONSTRUCTION EDITOR"0D)
;
WAIT  [BC
 DO B=0
 C=0
W1    C-
 IF C<>0 GOTO W1
 UNTIL DEC(B)=0
 ]BC RET
;
SCL   [HL [DE [BC
 !VOP
 HL=$D079
 DE=$D078
 BC=$00C8
 LDIR
 !VCL
 ]BC ]DE ]HL
 RET
;
SCL0  [HL [DE [BC
 !VOP
 HL=$D08A
 DO B=5
 !SCL00 DE=40
 HL=HL+DE
 UNTIL DEC(B)=0
 !VCL
 ]BC ]DE ]HL
 RET
;
SCL00 [HL [DE [BC DE=HL
 DE- BC=18
 LDIR ]BC ]DE ]HL
 RET
;
SCR   [HL [DE [BC
 !VOP
 HL=$D257
 DE=$D258
 BC=$00C8
 LDDR
 !VCL
 ]BC ]DE ]HL
 RET
;
WAIT0 [BC
 DO B=0
 UNTIL DEC(B)=0
 ]BC RET
;
DEMO  !GC !VC
 HL=0 (SC)=HL
 A=1 (MEN)=A
 A=0 (CONST)=A (ED)=A
 A=5 (MY)=A
 DE=DEM0 !$0889
 DE=DEM1 !$0889
 DE=DEM2 !$0889
 DE=DEM3 !$0889
 DE=DEM4 !$0889
 DE=DEM5 !$0889
 DE=DEM6 !$0889
 DE=DEM7 !$0889
 DO B=4
 !WAIT
 UNTIL DEC(B)=0
 DO B=3
 !SCL !WAIT0
 UNTIL DEC(B)=0
 !SCL0 !WAIT0
 DO B=17
 !SCR !WAIT0
 UNTIL DEC(B)=0
 HL=$0A23
 DO B=7
 ($11D1)=HL DE=DEM8 !$0889
 H-
 ($11D1)=HL DE=DEM7 !$0889
 !WAIT0 !WAIT0
 UNTIL DEC(B)=0
 DE=DE0 !$0889
 DE=DE1 !$0889
 DE=DE2 !$0889
 DE=DE3 !$0889
 DE=DE4 !$0889
 DE=DE5 !$0889
 DE=DE6 !$0889
KDEMO !VOP
 A="ñ" ($D28A)=A
 A="2" ($D28F)=A
 A="3" ($D294)=A
 !VCL
 DO BC=$300
 !$0832
 IF A="1" GOTO GAME
 IF A="2" GOTO CNSTG
 IF A="3" GOTO EDIT
 UNTIL DEC(BC)=0
 !VOP
 A="1" ($D28A)=A
 A="ò" ($D28F)=A
 A="3" ($D294)=A
 !VCL
 DO BC=$300
 !$0832
 IF A="1" GOTO GAME
 IF A="2" GOTO CNSTG
 IF A="3" GOTO EDIT
 UNTIL DEC(BC)=0
 !VOP
 A="1" ($D28A)=A
 A="2" ($D28F)=A
 A="ó" ($D294)=A
 !VCL
 DO BC=$300
 !$0832
 IF A="1" GOTO GAME
 IF A="2" GOTO CNSTG
 IF A="3" GOTO EDIT
 UNTIL DEC(BC)=0
 GOTO KDEMO
;
KW5   ."K"+$C3 ."."+$C3 ."W"+$C3 ."O"+$C3 ."R"+$C3 ."D"+$C3
KW10  ."1"+$C3 ."0"+$C3 ."M"+$C3 ."E"+$C3 ."N"+$C3 ."."+$C3
KW15  ."A"+$C3 ."P"+$C3 ."P"+$C3 ."L"+$C3 ."E"+$C3 ."2"+$C3
KW20  ."*"+$C3 ."M"+$C3 ."Z"+$C3 ."-"+$C3 ."B"+$C3 ."*"+$C3
KW25  ."C"+$C3 ."O"+$C3 ."M"+$C3 ."P"+$C3 ."A"+$C3 ."C"+$C3
KW30  ."["+$C3 ."]"+$C3 ."<"+$C3 .">"+$C3 ."("+$C3 .")"+$C3
KW35  ."A"+$C3 ."9"+$C3 ."5"+$C3 ."B"+$C3 ."Z"+$C3 ."Q"+$C3
KW40  ."Z"+$C3 ."."+$C3 ."G"+$C3 ."."+$C3 ."."+$C3 ."."+$C3
KW45  ."P"+$C3 ."i"+$C3 ."O"+$C3 ."I"+$C3 ."/"+$C3 ."O"+$C3
KW50  ."C"+$C3 ."."+$C3 ."T"+$C3 ."A"+$C3 ."P"+$C3 ."E"+$C3
KW55  ."M"+$C3 ."R"+$C3 ."-"+$C3 ."U"+$C3 ."4"+$C3 ."."+$C3
KW60  ."I"+$C3 ."F"+$C3 ."T"+$C3 ."H"+$C3 ."E"+$C3 ."N"+$C3
KW65  ."‚"+$C3 ."S"+$C3 ."C"+$C3 ."O"+$C3 ."R"+$C3 ."E"+$C3
KW70  ."?"+$C3 .">"+$C3 ."["+$C3 ."]"+$C3 ."<"+$C3 ."?"+$C3
KW75  ."3"+$C3 ."-"+$C3 ."4"+$C3 ."-"+$C3 ."8"+$C3 .";"+$C3
KW80  ."1"+$C3 ."~"+$C3 ."1"+$C3 ."0"+$C3 ."0"+$C3 ."M"+$C3
KW85  ."H"+$C3 ."A"+$C3 ."L"+$C3 ."T"+$C3 ."@"+$C3 ."&"+$C3
KW90  ."#"+$C3 ."$"+$C3 ."%"+$C3 ."!"+$C3 .$22+$C3 ."~"+$C3
KW95  ."V"+$C3 ."O"+$C3 ."T"+$C3 ."O"+$C3 ."M"+$C3 ."S"+$C3
KW100 ."("+$C3 ."A"+$C3 ."+"+$C3 ."-"+$C3 ."Z"+$C3 .")"+$C3
;
COSKB ($D049)=A !$0F14
COSK3 !$0832
 IF A<"0" GOTO COSK3
 IF A>="6" GOTO COSK3
 ($D04A)=A AF<>AF' !$0F14 AF<>AF'
 IF A="5" GOTO COSK6
COSK4 !$0832
 IF A<"0" GOTO COSK4
 IF A>=":" GOTO COSK4
 GOTO COSK5
;
COSK6 !$0832
 IF A<>"0" GOTO COSK6
 GOTO COSK5
;
COSK7 !$0832
 IF A<"1" GOTO COSK7
 IF A>=":" GOTO COSK7
 GOTO COSK5
;
COSK9 !VOP
COSK0 !$0832
 IF A="1" GOTO COSKA
 IF A="2" GOTO COSKB
 GOTO COSK0
COSKA ($D049)=A !$0F14
COSK1 !$0832
 IF A<"0" GOTO COSK1
 IF A>=":" GOTO COSK1
 ($D04A)=A AF<>AF' !$0F14 AF<>AF'
 IF A="0" GOTO COSK7
COSK2 !$0832
 IF A<"0" GOTO COSK2
 IF A>=":" GOTO COSK2
COSK5 ($D04B)=A AF<>AF' !$0F14 AF<>AF'
 E=$30 A=A-E C=A A=($D04A)
 A=A-E B=A B+ A=246
 DO
 A=A+10
 UNTIL DEC(B)=0
 A=A+C C=A A=($D049) !VCL
 A=A-E B=A A=0
 DO
 A=A+100
 UNTIL DEC(B)=0
 A=A+C (MEN)=A
 RET
;
CNSTG !VC DE=CNSTD
 !$0889 !COSK9
 A=1 (CONST)=A
 RET
;
KEY   DEFS 6
;
CNSTD !("ÅÝÒÝ ¶× Ê¼ÞÒÏ½¶ (101~250) ?   ¢£"0D)
EDITD !("ÅÝÒÝ ¦ ´ÃÞ¨¯Ä ¼Ï½¶ (101~250) ?  ¢£"0D)
KED   !("Please INPUT 'KEY WORD'   ¢£"0D)
GAME0 !("Push 1 or 2 key.                      "0D)
GAME1 !("     1. GAME START                      "0D)
GAME2 !("     2. INPUT 'KEY WORD'"0D)
;
GAME  !VC
 DE=GAME0 !$0889
 DE=GAME1 !$0889
 DE=GAME2 !$0889
GAMEK !VOP
 A="ñ" ($D02F)=A
 A="2" ($D034)=A
 !VCL
 DO BC=$500
 !$0832
 IF A="1" RET
 IF A="2" GOTO KW
 UNTIL DEC(BC)=0
 !VOP
 A="1" ($D02F)=A
 A="ò" ($D034)=A
 !VCL
 DO BC=$500
 !$0832
 IF A="1" RET
 IF A="2" GOTO KW
 UNTIL DEC(BC)=0
 GOTO GAMEK
;
KW    !VC
 DE=KED !$0889
 !VOP
 DO B=6
KEYWK !$0832
 IF A=0 GOTO KEYWK
 C=A
 !$0F14
 A=6 A=A-B
 D=0 E=A
 HL=$D045 HL=HL+DE
 A=C (HL)=A
 UNTIL DEC(B)=0
 HL=$D045
 DE=KEY
 BC=6
 LDIR
 !VCL
 HL=KW5 C=1
 DO B=20
 A=(MEN) A=A+5
 (MEN)=A
 !CHECK
 IF C=0 RET
 UNTIL DEC(B)=0
 GOTO DEMO
;
CHECK D=0
 A=(HL+) E=A
 A=(KEY) A=A+$C3
 IF A<>E THEN D=1
 A=(HL+) E=A
 A=(KEY+1) A=A+$C3
 IF A<>E THEN D=1
 A=(HL+) E=A
 A=(KEY+2) A=A+$C3
 IF A<>E THEN D=1
 A=(HL+) E=A
 A=(KEY+3) A=A+$C3
 IF A<>E THEN D=1
 A=(HL+) E=A
 A=(KEY+4) A=A+$C3
 IF A<>E THEN D=1
 A=(HL+) E=A
 A=(KEY+5) A=A+$C3
 IF A<>E THEN D=1
 IF D=0 THEN C=0
 RET
;
PUT   [HL [DE [BC [AF
 !VOP
 A=(GX) C=A
 A=(GY) B=A
 HL=GAMEN-40
 DE=BC
 D=0
 HL=HL+DE DE=40
 DO B+
 HL=HL+DE
 UNTIL DEC(B)=0
 A=(GZ)
 [AF
 IF A>=6 THEN A=6
 (HL+)=A (HL)=A
 DE=39 HL=HL+DE
 (HL+)=A (HL)=A
 A=(GX) C=A
 A=(GY) B=A
 ]AF
 B+ C+
 HL=$E3C0
 DO
 HL+
 UNTIL DEC(C)=0
 DO DE=320
 HL=HL+DE
 UNTIL DEC(B)=0
 DE<>HL HL=GC0-32 A+
 DO B=A
 HL=HL+32
 UNTIL DEC(B)=0
 HL<>DE
 DO B=16
 A=(DE+)
 (HL)=A
 HL=HL+40
 UNTIL DEC(B)=0
 HL=HL-639
 DO B=16
 A=(DE+)
 (HL)=A
 HL=HL+40
 UNTIL DEC(B)=0
 !VCL
 ]AF ]BC ]DE ]HL
 RET
;
GX    DEFS 1
GY    DEFS 1
GZ    DEFS 1
;
GAMN  !("")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("                                      ")
 !("")
;
GC0   DEFS 32
GC1   !(000042A65E42BE46AAC67E7C60627E3C000042657A427D6255637E3E06467E3C)
GC2   !(00001884E294A8B4847E3EFE60627E3C000018214729152D217E7C7F06467E3C)
GC3   !(FF01FD05F515D55555D515F505FD01FFFF80BFA0AFA8ABAAAAABA8AFA0BF80FF)
GC4   !(1824429999422418182442999942241818244299994224181824429999422418)
GC5   !(FEFEFE00F7F7F700FEFEFE00F7F7F700FEFEFE00F7F7F700FEFEFE00F7F7F700)
GC6   !(0000C0F0F8FCFCFEFEFEFCFCFEFE3C180000030F1F3F3F7F7F7F3F3F7F7F3C18)
GC7   !(0000C0F0F8DCDCFE7E7EFCFCFEFE3C180000030F1F3B3B7F7E7E3F3F7F7F3C18)
GC8   !(0000C0F0F8DCDCFE7EBC7CFCFCFE3C180000071F3F3F7F7F7C7F3C3F7F7F3C18)
GC9   !(0000E0F8FCFCFEFE3EFE3CFCFEFE3C180000030F1F3B3B7F7E3D3E3F3F7F3C18)
GCBOM !(00C0F0A8DCADFF7EBCFDFFFFFE3C000000030F153BB5FF7E3DBFFFFF7F3C0000)
GC10  !(FCD6EF57BEFF3E1C3F6BF7EA7DFF7C38)
GC11  !(417F11FE86FD7F7E82FE847F61BFFE7E)
GC12  !(80CEE2BE88BD7F7E0173477D11BDFE7E)
;
SPUT  [HL [DE [BC [AF
 !VOP
 A=(GX) C=A
 A=(GY) B=A
 HL=GAMEN-40
 DE=BC
 D=0
 HL=HL+DE DE=40
 DO B=B+1
 HL=HL+DE
 UNTIL DEC(B)=0
 A=(GZ)
 (HL+)=A (HL)=A
 A=(GX) C=A
 A=(GY) B=A
 A=(GZ)
 B+ C+
 HL=$E3C0
 DO
 HL+
 UNTIL DEC(C)=0
 DO DE=320
 HL=HL+DE
 UNTIL DEC(B)=0
 DE=GC0
 IF A=10 THEN DE=GC10
 IF A=11 THEN DE=GC11
 IF A=12 THEN DE=GC12
 DO B=8
 A=(DE+)
 (HL)=A
 HL=HL+40
 UNTIL DEC(B)=0
 HL=HL-319
 DO B=8
 A=(DE+)
 (HL)=A
 HL=HL+40
 UNTIL DEC(B)=0
 !VCL
 ]AF ]BC ]DE ]HL
 RET
;
WALLS (HL)=$FE HL=HL+DE
 (HL)=$FE HL=HL+DE
 (HL)=$FE HL=HL+DE
 (HL)=$00 HL=HL+DE
 (HL)=$F7 HL=HL+DE
 (HL)=$F7 HL=HL+DE
 (HL)=$F7 HL=HL+DE
 (HL)=$00
 RET
;
WALL  [BC [DE [HL [AF
 IF A<>0 THEN !GGC GOTO WALL0
 !GC
WALL0 !VOP
 HL=$E000
 DO B=40
 DE=40 !WALLS
 DE=279 HL=HL-DE
 UNTIL DEC(B)=0
 HL=$E3C0
 DO B=40
 DE=40 !WALLS
 DE=279 HL=HL-DE
 UNTIL DEC(B)=0
 HL=$FE00
 DO B=40
 DE=40 !WALLS
 DE=279 HL=HL-DE
 UNTIL DEC(B)=0
 HL=$E140 DE=40
 DO B=23
 !WALLS
 HL=HL+DE
 UNTIL DEC(B)=0
 HL=$E167
 DO B=23
 !WALLS
 HL=HL+DE
 UNTIL DEC(B)=0
 HL=$E151
 !WALLS
 HL=HL+DE
 !WALLS
 HL=$E15B
 !WALLS
 HL=HL+DE
 !WALLS
 !VCL
 ]AF ]HL ]DE ]BC
 RET
;
MYX   DEFS 1
MYY   DEFS 1
;
T11   DEFS 3
T12   DEFS 3
T13   DEFS 3
T14   DEFS 3
T21   DEFS 3
T22   DEFS 3
T23   DEFS 3
T24   DEFS 3
;
IWA1  DEFS 3
IWA2  DEFS 3
IWA3  DEFS 3
IWA4  DEFS 3
IWA5  DEFS 3
IWA6  DEFS 3
IWA7  DEFS 3
IWA8  DEFS 3
IWA9  DEFS 3
IWA10 DEFS 3
IWA11 DEFS 3
IWA12 DEFS 3
IWA13 DEFS 3
IWA14 DEFS 3
IWA15 DEFS 3
;
TIME  DEFS 2
CONST DEFS 1
;
S3    !VC
 A=0
 (BOM)=A
 (CLR)=A
 (MYX)=A
 (MYY)=A
 (BGMD)=A
 HL=1500
 (TIME)=HL
 HL=T11
 (HL)=0
 DE=T11+1
 BC=68
 LDIR
 HL=END-190
 A=(MEN)
 DO DE=190
 HL=HL+DE
 UNTIL DEC(A)=0
 !WALL
 E=0
S3S1  D=0
S3S2  A=(HL)
 [HL
 !TOROK
 ]HL
 (GZ)=A
 A=D (GX)=A
 A=E (GY)=A
 !PUT
 HL+
 D++
 A=38
 IF A<>D GOTO S3S2
 E++
 A=20
 IF A<>E GOTO S3S1
 DE=S3D1 !$0889
 DE=S3D2 !$0889
 A=(CLR) IF A=0 GOTO S3S5
S3S6  HL=$E15C
 A=(MY)
S3S3  IF DEC(A)=0 GOTO S3S4
 [AF !VOP
 DE=GC7
 DO B=16
 A=(DE+) (HL)=A
 HL=HL+40
 UNTIL DEC(B)=0
 HL=HL-639
 DO B=16
 A=(DE+) (HL)=A
 HL=HL+40
 UNTIL DEC(B)=0
 HL=HL-639
 !VCL ]AF
 GOTO S3S3
S3S4  !SSC A=(ED) IF A<>0 RET
 DO A=3
 !WAIT
 UNTIL DEC(A)=0
 RET
;
S3S5  A=(CONST)
 IF A<>0 GOTO S3S6
 HL=L0 (SP)<>HL RET
;
TOROK IF A=" " THEN A=0 RET
 IF A="6" THEN A=9 RET
 IF A="5" THEN A=5 RET
 IF A="4" THEN A=(CLR) A=A+4 (CLR)=A A=4 RET
 IF A="3" GOTO TR3
 IF A="2" GOTO TR2
 IF A="1" GOTO TR1
 RET
;
TR1   HL=T11+2
TR1S  A=(HL)
 IF A<>0 THEN HL++ HL+ GOTO TR1S
 (HL)=1 HL-
 (HL)=E HL-
 (HL)=D
 A=1 RET
;
TR2   HL=T21+2
TR2S  A=(HL)
 IF A<>0 THEN HL++ HL+ GOTO TR2S
 (HL)=1 HL-
 (HL)=E HL-
 (HL)=D
 A=2 RET
;
TR3   HL=IWA1+2
TR3S  A=(HL)
 IF A<>0 THEN HL++ HL+ GOTO TR3S
 (HL)=1 HL-
 (HL)=E HL-
 (HL)=D
 A=3 RET
;
S3D1  !("HI-SCORE         SCENE"0D)
S3D2  !("SCORE         TIME"0D)
;
SSCD1 !("     0"0D)
;
SSC   [BC [DE [HL [AF
 HL=(SC) [HL
 DE<>HL
 HL=(HI) CY=0
 HL=HL-DE
 IF CY THEN ]HL [HL (HI)=HL
 ]HL
 !SSCS
 HL=$11D1
 (HL)=11
 HL+ (HL)=2
 DE=SSCD1 !SCS
 !$0889
 HL=(HI)
 !SSCS
 HL=$11D1
 (HL)=11
 HL+ (HL)=1
 DE=SSCD1 !SCS
 !$0889
 HL=(TIME)
 !SSCS
 HL=$11D1
 (HL)=23
 HL+ (HL)=2
 DE=SSCD1+1 !SCS0
 HL=SSCD1+5
 (HL)=$0D
 !$0889
 (HL)="0"
 HL=(MEN)
 H=0
 !SSCS
 HL=$11D1
 (HL)=24
 HL+ (HL)=1
 DE=SSCD1+2 !SCS
 HL=SSCD1+5
 (HL)=$0D
 !$0889
 (HL)="0"
 ]AF ]HL ]DE ]BC
 RET
;
SSCS  CY=0
 DE=10000 C=0 B=$30
SSCS1 HL=HL-DE
 IF NC THEN C+ GOTO SSCS1
 HL=HL+DE A=C A=A+B
 (SSCD1)=A
 DE=1000 C=0
SSCS2 HL=HL-DE
 IF NC THEN C+ GOTO SSCS2
 HL=HL+DE A=C A=A+B
 (SSCD1+1)=A
 DE=100 C=0
SSCS3 HL=HL-DE
 IF NC THEN C+ GOTO SSCS3
 HL=HL+DE A=C A=A+B
 (SSCD1+2)=A
 DE=10 C=0
SSCS4 HL=HL-DE
 IF NC THEN C+ GOTO SSCS4
 HL=HL+DE A=C A=A+B
 (SSCD1+3)=A
 A=L A=A+B
 (SSCD1+4)=A
 RET
;
SCS   [AF [HL [BC
 HL=SSCD1
 DO B=5
 A=(HL)
 IF A<>"0" GOTO SCSS
 A=" "
 (HL+)=A
 UNTIL DEC(B)=0
SCSS  ]BC ]HL ]AF
 RET
;
SCS0  [AF [HL [BC
 HL=SSCD1+1
 DO B=3
 A=(HL)
 IF A<>"0" GOTO SCSS
 A=" "
 (HL+)=A
 UNTIL DEC(B)=0
 GOTO SCSS
;
BOMY0 DE=MS1
 !$0F3F
 A=(MY) A-
 (MY)=A
 IF A<>0 GOTO L1
 DE=MS2
 !$0F3F
 !WALL
 DE=BOMYD
 !$0889
 DO B=8
 !WAIT
 UNTIL DEC(B)=0
 GOTO L0
;
BOMY  A=10 (GZ)=A
 A=(MYX) (GX)=A
 A=(MYY) (GY)=A
 !PUT GOTO BOMY0
;
MS1   !("-C0-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C-D-C"0D)
MS2   !("R9+B2+A+G+F+E+D+CBAGEDC-B-A-G-F-E-D-C-D-E-F-G-A-BR-C9"0D)
BOMYD !("               GAME OVER"0D)
;
CLR1  HL=(SC)
 DE=100
 HL=HL+DE
 (SC)=HL
 !SSC !WAIT
 DE=MS3
 !$0F3F
 A=(MEN) A+
 (MEN)=A B=A
 A=(CONST)
 IF A<>0 GOTO L1
 DO A=101
 IF A=B GOTO KEYP
 A=A-5
 UNTIL A=1
 !WAIT
 GOTO L1
;
MS3   !("B2AGBDGBAFBBAGBDGBAFBBAGBDGBAFB9"0D)
;
CLR1D !("                KEY WORD"0D)
CLR2D !("            PUSH [SPACE] KEY"0D)
;
KEYP  [AF A=1 !WALL ]AF
 DE=CLR1D
 !$0889 HL=KW5-6
 DO DE=6
 HL=HL+DE A=A-5
 UNTIL A=1
 !VOP
 DE=$D1F1
 DO B=6
 A=(HL+) A=A-$C3
 (DE+)=A
 UNTIL DEC(B)=0
 !VCL
 DE=CLR2D
 !$0889
CLKEY !$0832
 IF A<>" " GOTO CLKEY
 GOTO L1
;
CLEAR !GC
 DE=CRD1 !$0889 !$0A2E
 DE=CRD2 !$0889 !$0A2E
 DE=CRD3 !$0889 !$0A2E
 DE=CRD4 !$0889 !$0A2E
 DE=CRD5 !$0889 !$0A2E
 DE=CRD6 !$0889 !$0A2E
 DO B=3
 DE=MS3
 !$0F3F
 UNTIL DEC(B)=0
CRK   !$0832
 IF A<>" " GOTO CRK
 GOTO L0
;
CRD1  !("µÒÃÞÄ³ !!"0D)
CRD2  !(" ±ÅÀ Ê, 100ÒÝ ¾ÞÝÌÞ ¦ ¸ØÔ- ¼Ï¼À¡"0D)
CRD3  !(" ´ÃÞ¨À- ÃÞ µØ¼ÞÅÙ É ÒÝ ¦ Â¸¯Ã ÌÀÀËÞ"0D)
CRD4  !(" ÌßÚ² ¼Ã¸ÀÞ»²¡"0D)
CRD5  !(" Let's try again 'XETTER 2'"0D)
CRD6  !(" PUSH [SPACE] KEY"0D)
;
BGMD  DEFS 1
;
BGM   !("G1*G1*F1*E1*D1*G1*G1*F1*E1*D1*")
 !("G1*G1*F1*E1*D1*G1*G1*A1*B1*")
 !("G1*G1*F1*E1*D1*G1*G1*F1*E1*D1*")
 !("G1*G1*F1*E1*D1*G1*G1*A1*B1*")
 !("B1*G1*B1*G1*B1*G1*G1*A1*B1*A1*F1*A1*F1*A1*F1*")
 !("E1*D1*C1*")
 !("B1*G1*B1*G1*B1*G1*G1*A1*B1*A1*F1*A1*F1*A1*F1*")
 !("E1*D1*C1*")
;
IMOVE HL=BGM-3
 A=(BGMD) A+
 IF A=75 THEN A=1
 (BGMD)=A DO
 HL++ HL+ DE=HL
 UNTIL DEC(A)=0
 !$0F3F
 A=0 !$0901     ;Key data clear
 !$0832
 IF A="4" GOTO IM4
 IF A="6" GOTO IM6
 IF A="2" GOTO IM2
 IF A="8" GOTO IM8
 IF A=12 THEN A=1 (BOM)=A
 RET
;
IM4   HL=(MYX)
 !XHL
 HL- A=(HL)
 B=A DE=40
 HL=HL+DE
 A=(HL)
 IF A<>B GOTO IM4S
 IF A=5 GOTO IM4P
 IF A=4 THEN A=(CLR) A-- (CLR)=A HL=(SC) HL++ (SC)=HL A=5
 IF A=2 THEN A=1
 IF A=1 THEN (BOM)=A
 IF A=3 GOTO IM4E
IM4PS HL=(MYX)
 (GX)=HL
 A=0 (GZ)=A
 !PUT
 A=(MYX)
 A- (MYX)=A
IM4P  HL=(MYX)
 (GX)=HL
 A=8 (GZ)=A
 !PUT
 RET
;
IM4E  HL=(MYX)
 !XHL
 HL-- HL-
 A=(HL) B=A
 DE=40 HL=HL+DE
 A=(HL)
 IF A<>B GOTO IM4P
 IF A<>0 GOTO IM4P
 A=4 !ISECH
 IF HL=0 GOTO IM4P
 A=(HL) A-
 (HL)=A
 HL=(MYX) L--
 (GX)=HL
 A=0 (GZ)=0
 !PUT
 L-
 (GX)=HL
 A=3 (GZ)=A
 !PUT
 GOTO IM4PS
;
ISECH HL=(MYX)
 IF A=4 THEN L--
 IF A=6 THEN L++
 BC=IWA1 DE=HL A=0
ISH0  [AF A=(BC) BC+
 L=A A=(BC)
 H=A BC+
 A=(BC) BC+
 IF A=0 GOTO ISH1
 HL=HL-DE
 IF H<>0 GOTO ISH1
 IF L<>0 GOTO ISH1
 ]AF BC-- BC-
 HL=BC
 RET
;
ISH1  ]AF A+
 IF A=15 THEN HL=0 RET
 GOTO ISH0
;
IM6   HL=(MYX)
 !XHL
 HL++ A=(HL)
 B=A
 DE=40 HL=HL+DE
 A=(HL)
 IF A<>B GOTO IM6S
 IF A=5 GOTO IM6P
 IF A=4 THEN A=(CLR) A-- (CLR)=A HL=(SC) HL++ (SC)=HL A=5
 IF A=2 THEN A=1
 IF A=1 THEN (BOM)=A
 IF A=3 GOTO IM6E
IM6PS HL=(MYX)
 (GX)=HL
 A=0 (GZ)=A
 !PUT
 A=(MYX)
 A+ (MYX)=A
IM6P  HL=(MYX)
 (GX)=HL
 A=9 (GZ)=A
 !PUT
 RET
;
IM6E  HL=(MYX)
 !XHL
 HL++ HL++
 A=(HL) B=A
 DE=40 HL=HL+DE
 A=(HL)
 IF A<>B GOTO IM6P
 IF A<>0 GOTO IM6P
 A=6 !ISECH
 IF HL=0 GOTO IM6P
 A=(HL) A+
 (HL)=A
 HL=(MYX) L++
 (GX)=HL
 A=0 (GZ)=0
 !PUT
 L+
 (GX)=HL
 A=3 (GZ)=A
 !PUT
 GOTO IM6PS
;
IM2   HL=(MYX)
 !XHL DE=80
 HL=HL+DE A=(HL)
 B=A
 HL+
 A=(HL)
 IF A<>B GOTO IM2S
 IF A=5 GOTO IM2P
 IF A=4 THEN A=(CLR) A-- (CLR)=A HL=(SC) HL++ (SC)=HL A=5
 IF A=2 THEN A=1
 IF A=1 THEN (BOM)=A
 IF A=3 GOTO IM2P
IM2PS HL=(MYX)
 (GX)=HL
 A=0 (GZ)=A
 !PUT
 A=(MYY)
 A+ (MYY)=A
IM2P  HL=(MYX)
 (GX)=HL
 A=7 (GZ)=A
 !PUT
 RET
;
IM8   HL=(MYX)
 !XHL DE=40
 HL=HL-DE A=(HL)
 B=A
 HL+
 A=(HL)
 IF A<>B GOTO IM8S
 IF A=5 GOTO IM8P
 IF A=4 THEN A=(CLR) A-- (CLR)=A HL=(SC) HL++ (SC)=HL A=5
 IF A=2 THEN A=1
 IF A=1 THEN (BOM)=A
 IF A=3 GOTO IM8P
IM8PS HL=(MYX)
 (GX)=HL
 A=0 (GZ)=A
 !PUT
 A=(MYY)
 A- (MYY)=A
IM8P  HL=(MYX)
 (GX)=HL
 A=6 (GZ)=A
 !PUT
 RET
;
XHL   [DE [BC [AF
 DE=HL
 HL=GAMEN-40
 B=D D=0
 HL=HL+DE DE=40
 DO B+
 HL=HL+DE
 UNTIL DEC(B)=0
 ]AF ]BC ]DE
 RET
;
IM4S  IF A=5 GOTO IM4P
 B-- B-- B- IF B=0 GOTO IM4P
 IF A=3 GOTO IM4P
 B++ IF B=0 GOTO IM4P
 B+ IF A=1 THEN IF B=0 GOTO IM4SA
 B+ IF A=2 THEN IF B=0 GOTO IM4SA
 B+ IF A=1 THEN IF B=0 GOTO IM4SA
 B- IF B=0 THEN IF A=0 GOTO IM4SA
 B+ IF A=2 THEN IF B=0 GOTO IM4SA
 B-- IF B=0 THEN IF A=0 GOTO IM4SA
 B-- IF A=1 THEN IF B=0 GOTO IM4SB
 B++ B+ IF B=0 THEN IF A=4 GOTO IM4SB
 B-- B- IF A=2 THEN IF B=0 GOTO IM4SB
 B++ IF B=0 THEN IF A=4 GOTO IM4SB
 HL=(SC) HL+ (SC)=HL A=(CLR) A- (CLR)=A GOTO IM4PS
IM4SA A=1 (BOM)=A GOTO IM4PS
IM4SB A=1 (BOM)=A HL=(SC) HL+ (SC)=HL
 A=(CLR) A- (CLR)=A GOTO IM4PS
;
IM6S  IF A=5 GOTO IM6P
 B-- B-- B- IF B=0 GOTO IM6P
 IF A=3 GOTO IM6P
 B++ IF B=0 GOTO IM6P
 B+ IF A=1 THEN IF B=0 GOTO IM6SA
 B+ IF A=2 THEN IF B=0 GOTO IM6SA
 B+ IF A=1 THEN IF B=0 GOTO IM6SA
 B- IF B=0 THEN IF A=0 GOTO IM6SA
 B+ IF A=2 THEN IF B=0 GOTO IM6SA
 B-- IF B=0 THEN IF A=0 GOTO IM6SA
 B-- IF A=1 THEN IF B=0 GOTO IM6SB
 B++ B+ IF B=0 THEN IF A=4 GOTO IM6SB
 B-- B- IF A=2 THEN IF B=0 GOTO IM6SB
 B++ IF B=0 THEN IF A=4 GOTO IM6SB
 HL=(SC) HL+ (SC)=HL A=(CLR) A- (CLR)=A GOTO IM6PS
IM6SA A=1 (BOM)=A GOTO IM6PS
IM6SB A=1 (BOM)=A HL=(SC) HL+ (SC)=HL
 A=(CLR) A- (CLR)=A GOTO IM6PS
;
IM2S  IF A=5 GOTO IM2P
 B-- B-- B- IF B=0 GOTO IM2P
 IF A=3 GOTO IM2P
 B++ IF B=0 GOTO IM2P
 B+ IF A=1 THEN IF B=0 GOTO IM2SA
 B+ IF A=2 THEN IF B=0 GOTO IM2SA
 B+ IF A=1 THEN IF B=0 GOTO IM2SA
 B- IF B=0 THEN IF A=0 GOTO IM2SA
 B+ IF A=2 THEN IF B=0 GOTO IM2SA
 B-- IF B=0 THEN IF A=0 GOTO IM2SA
 B-- IF A=1 THEN IF B=0 GOTO IM2SB
 B++ B+ IF B=0 THEN IF A=4 GOTO IM2SB
 B-- B- IF A=2 THEN IF B=0 GOTO IM2SB
 B++ IF B=0 THEN IF A=4 GOTO IM2SB
 HL=(SC) HL+ (SC)=HL A=(CLR) A- (CLR)=A GOTO IM2PS
IM2SA A=1 (BOM)=A GOTO IM2PS
IM2SB A=1 (BOM)=A HL=(SC) HL+ (SC)=HL
 A=(CLR) A- (CLR)=A GOTO IM2PS
;
IM8S  IF A=5 GOTO IM8P
 B-- B-- B- IF B=0 GOTO IM8P
 IF A=3 GOTO IM8P
 B++ IF B=0 GOTO IM8P
 B+ IF A=1 THEN IF B=0 GOTO IM8SA
 B+ IF A=2 THEN IF B=0 GOTO IM8SA
 B+ IF A=1 THEN IF B=0 GOTO IM8SA
 B- IF B=0 THEN IF A=0 GOTO IM8SA
 B+ IF A=2 THEN IF B=0 GOTO IM8SA
 B-- IF B=0 THEN IF A=0 GOTO IM8SA
 B-- IF A=1 THEN IF B=0 GOTO IM8SB
 B++ B+ IF B=0 THEN IF A=4 GOTO IM8SB
 B-- B- IF A=2 THEN IF B=0 GOTO IM8SB
 B++ IF B=0 THEN IF A=4 GOTO IM8SB
 HL=(SC) HL+ (SC)=HL A=(CLR) A- (CLR)=A GOTO IM8PS
IM8SA A=1 (BOM)=A GOTO IM8PS
IM8SB A=1 (BOM)=A HL=(SC) HL+ (SC)=HL
 A=(CLR) A- (CLR)=A GOTO IM8PS
;
EMOVE HL=IWA1
 DO B=15
 !EMS
 A=(BOM)
 IF A=1 RET
 HL++ HL+
 UNTIL DEC(B)=0
 RET
;
EMS   [HL [BC
 (EMSMC)=0
 DE=HL
 HL++ A=(HL)
 IF A=0 THEN ]BC ]HL RET
 HL--
 HL=(HL)
 !XHL
 HL=HL+80
 A=(HL)
 IF A=5 THEN ]BC ]HL RET
 IF A=4 THEN ]BC ]HL RET
 IF A=3 THEN ]BC ]HL RET
 B=A HL+
 A=(HL)
 IF A=5 THEN ]BC ]HL RET
 IF A=4 THEN ]BC ]HL RET
 IF A=3 THEN ]BC ]HL RET
 IF A=0 THEN IF B=0 GOTO EMS1
 !EMS0
EMS1  HL=DE
 HL=(HL)
 (GX)=HL
 (GZ)=0
 !PUT
 HL=DE HL+
 A=(HL) A+
 (HL)=A HL-
 HL=(HL)
 (GX)=HL
 (GZ)=3
 !PUT
EMS2  A=(EMSMC)
 IF A<>0 THEN A- (EMSMC)=A DE=MS !$0F3F GOTO EMS2
 ]BC ]HL
 RET
;
EMS0  IF A<>B GOTO EMS0S
 IF A=6 GOTO IDED
 HL=DE HL=(HL)
 !ESECH
 IF HL=0 GOTO EMS0S
 (EMSMC)=1
 HL++ A=2
 (HL)=A
 HL- A=(HL)
 A+ (HL)=A
 HL- HL=(HL)
 (GX)=HL
 A=B A=A+10
 (GZ)=A
 !SPUT
 HL=(SC)
 HL=HL+20
 (SC)=HL
 RET
;
MS    !("+C1+E+G"0D)
;
IDED  A=1 (BOM)=A
 A=(MYY)
 A+ (MYY)=A
 HL=(MYX)
 (GX)=HL
 A=10 (GZ)=A
 !SPUT
 RET
;
ESECH [DE [BC
 H++ DE=HL
 BC=T11 A=0
ESE   [AF A=(BC) BC+
 L=A A=(BC)
 H=A BC+
 A=(BC) BC+
 IF A=2 GOTO ESES
 IF A=0 GOTO ESES
 HL=HL-DE
 IF H<>0 GOTO ESES
 IF L<>0 GOTO ESES
 ]AF BC-- BC-
 HL=BC
 ]BC ]DE
 RET
;
ESES  ]AF A+
 IF A=8 THEN ]BC ]DE HL=0 RET
 GOTO ESE
;
EMSMC DEFS 1
;
EMS0S HL=DE
 HL=(HL) !XHL
 HL=HL+79
 EXX
 HL=0
 EXX
 A=(HL)
 IF A=6 GOTO EMI
 [AF !SECH
 IF HL=0 THEN ]AF GOTO EMS1S
 (EMSMC)=1
 [HL
 HL=(HL)
 (GX)=HL
 (GZ)=0
 !PUT ]HL
 ]AF HL++ B=A
 A=2 (HL)=A
 HL- A=(HL)
 A+ (HL)=A
 HL-
 HL=(HL)
 (GX)=HL
 A=B
 A=A+10
 (GZ)=A
 !SPUT
 HL=(SC)
 HL=HL+20
 (SC)=HL
EMS1S HL=DE
 HL=(HL) !XHL
 HL=HL+81
 EXX
 HL=1
 EXX
 A=(HL)
 IF A=6 GOTO EMI
 [AF !SECH
 IF HL=0 THEN ]AF RET
 [HL HL=EMSMC (HL)+ ]HL
 [HL HL=(HL)
 (GX)=HL
 A=0 (GZ)=A
 !PUT ]HL
 ]AF HL++ B=A
 A=2 (HL)=A
 HL- A=(HL)
 A+ (HL)=A
 HL-
 HL=(HL)
 (GX)=HL
 A=B
 A=A+10
 (GZ)=A
 !SPUT
 HL=(SC)
 HL=HL+20
 (SC)=HL
 RET
;
SECH  [DE
 HL=DE HL=(HL) H++
 L+ DE=HL BC=T11
 EXX [HL EXX ]HL
 IF HL=0 THEN E--
 A=0
SECH1 [AF A=(BC) BC+
 L=A A=(BC)
 H=A BC+
 A=(BC) BC+
 IF A=2 GOTO SECH2
 IF A=0 GOTO SECH2
 HL=HL-DE
 IF H<>0 GOTO SECH2
 IF L<>0 GOTO SECH2
 ]AF BC-- BC-
 HL=BC
 ]DE
 RET
;
SECH2 ]AF A+
 IF A=8 THEN ]DE HL=0 RET
 GOTO SECH1
;
EMI   (BOM)=1
 HL=(MYX)
 (GX)=HL
 (GZ)=0
 !PUT
 A=(MYY)
 A+ (MYY)=A
 HL=(MYX)
 (GX)=HL
 A=10 (GZ)=A
 !SPUT
 EXX
 [HL
 EXX
 ]HL
 IF HL=0 GOTO EMS1S
 RET
;
YMOVE HL=T11
 DO B=4 A=1
 !T1E HL++ HL+
 UNTIL DEC(B)=0
 DO B=4 A=2
 !T1E HL++ HL+
 UNTIL DEC(B)=0
 RET
;
ARD   DEFS 8
;
AR    BC=ARD
 HL=(HL) !XHL
 HL=HL-40
 A=(HL) (BC)=A
 BC+ HL+
 A=(HL) (BC)=A
 BC+ HL=HL+38
 A=(HL) (BC)=A
 BC+ HL=HL+40
 A=(HL) (BC)=A
 BC+ HL=HL-37
 A=(HL) (BC)=A
 BC+ HL=HL+40
 A=(HL) (BC)=A
 BC+ HL=HL+38
 A=(HL) (BC)=A
 BC+ HL+
 A=(HL) (BC)=A
 RET
;
ARSD  DEFS 4
;
ARS   (ARSD)=0 (ARSD+1)=0
 (ARSD+2)=0 (ARSD+3)=0
 BC=ARD
 HL=ARSD
 DO A=4
 [AF
 A=(BC)
 IF A<>0 THEN IF A<>6 GOTO ARSE1
 BC+
 A=(BC) BC-
 IF A<>0 THEN IF A<>6 GOTO ARSE1
 (HL)=1
ARSE1 BC++ HL+
 ]AF
 UNTIL DEC(A)=0
 RET
;
T1E1  HL=DE
 HL=(HL)
 A=(ARSD) IF A=1 THEN H- GOTO T1E1U
 A=(ARSD+1) IF A=1 THEN L- GOTO T1E1L
 A=(ARSD+3) IF A=1 THEN H+ GOTO T1E1D
 A=(ARSD+2) IF A=1 THEN L+ GOTO T1E1R
;
T1E1D BC=HL
 !XHL HL=HL+40
 A=(HL) IF A=6 THEN (BOM)=1
 HL+
 A=(HL) IF A=6 THEN (BOM)=1
 HL=DE HL=(HL)
 (GX)=HL A=0 (GZ)=A !PUT
 ]HL ]AF [AF [HL HL=BC
 (GX)=HL (GZ)=A !PUT
 HL<>DE (HL)=DE
 ]HL ]AF ]BC
 RET
;
T1E1R BC=HL
 !XHL HL+
 A=(HL) IF A=6 THEN (BOM)=1
 HL=HL+40
 A=(HL) IF A=6 THEN (BOM)=1
 HL=DE HL=(HL)
 (GX)=HL A=0 (GZ)=A !PUT
 ]HL ]AF [AF [HL HL=BC
 (GX)=HL (GZ)=A !PUT
 HL<>DE (HL)=DE
 ]HL ]AF ]BC
 RET
;
T1E1U BC=HL
 !XHL
 A=(HL) IF A=6 THEN (BOM)=1
 HL+
 A=(HL) IF A=6 THEN (BOM)=1
 HL=DE HL=(HL)
 (GX)=HL A=0 (GZ)=A !PUT
 ]HL ]AF [AF [HL HL=BC
 (GX)=HL (GZ)=A !PUT
 HL<>DE (HL)=DE
 ]HL ]AF ]BC
 RET
;
T1E1L BC=HL
 !XHL
 A=(HL) IF A=6 THEN (BOM)=1
 HL=HL+40
 A=(HL) IF A=6 THEN (BOM)=1
 HL=DE HL=(HL)
 (GX)=HL A=0 (GZ)=A !PUT
 ]HL ]AF [AF [HL HL=BC
 (GX)=HL (GZ)=A !PUT
 HL<>DE (HL)=DE
 ]HL ]AF ]BC
 RET
;
TEC   HL++ (HL)=0
 HL-- HL=(HL)
 (GX)=HL
 A=0 (GZ)=A
 !SPUT
 ]HL ]AF ]BC
 RET
;
T1E   [BC [AF [HL
 DE=HL HL++
 A=(HL) HL--
 IF A=0 THEN ]HL ]AF ]BC RET
 IF A=2 GOTO TEC
 !AR !ARS
 HL=ARSD C=0
 DO B=4
 A=(HL)
 A=A+C C=A
 HL+
 UNTIL DEC(B)=0
 IF C=0 THEN ]HL ]AF ]BC RET
 C- IF C=0 GOTO T1E1
 HL=DE HL=(HL)
 (HLS)=HL
 ]HL ]AF [AF [HL
 HL=(HLS)
 IF A=1 GOTO T2E
 A=(DE) B=A
 A=(MYX)
 IF A<>B GOTO T1ES
 A=(+DE-)
 B=A A=(MYY)
 IF A>=B GOTO T1E0
 A=(ARSD)
 IF A=1 THEN H- GOTO T1E1U
 GOTO T1ES
T1E0  A=(ARSD+3)
 IF A=1 THEN H+ GOTO T1E1D
T1ES  A=(+DE-) B=A
 A=(MYY)
 IF A<>B GOTO RMOVE
 A=(DE)
 B=A A=(MYX)
 IF A>=B GOTO T1E2
 A=(ARSD+1)
 IF A=1 THEN L- GOTO T1E1L
 GOTO RMOVE
T1E2  A=(ARSD+2)
 IF A=1 THEN L+ GOTO T1E1R
 GOTO RMOVE
;
HLS   DEFS 2
;
RND    [DE [HL
 HL<>DE DE=(HL) DE<>HL
 DE=HL HL=(RNDD)
 HL=HL+DE
 A=H A=A+L
 L=A A=A+H
 L=A DE=$36
 HL=HL+DE (RNDD)=HL
 A=L ]HL ]DE
 RET
;
RNDD  !(1234)
;
RMOVE B=4
RMOV1 HL=DE HL=(HL) !RND
 IF DEC(B)=0 GOTO T1E1
 IF A>=0 THEN IF A<$40 GOTO RM0
 IF A>=$40 THEN IF A<$80 GOTO RM1
 IF A>=$80 THEN IF A<$C0 GOTO RM2
 GOTO RM3
;
RM0   A=(ARSD) IF A=1 THEN H- GOTO T1E1U
 GOTO RMOV1
;
RM1   A=(ARSD+1) IF A=1 THEN L- GOTO T1E1L
 GOTO RMOV1
;
RM2   A=(ARSD+2) IF A=1 THEN L+ GOTO T1E1R
 GOTO RMOV1
;
RM3   A=(ARSD+3) IF A=1 THEN H+ GOTO T1E1D
 GOTO RMOV1
;
T2E   A=(DE)
 B=A A=(MYX)
 IF A=B GOTO T2ES
 IF A>=B GOTO T2E0
 A=(ARSD+1)
 IF A=1 THEN L- GOTO T1E1L
 GOTO RMOVE
T2E0  A=(ARSD+2)
 IF A=1 THEN L+ GOTO T1E1R
 GOTO RMOVE
T2ES  A=(+DE-)
 B=A A=(MYY)
 IF A>=B GOTO T2E1
 A=(ARSD)
 IF A=1 THEN H- GOTO T1E1U
 GOTO RMOVE
T2E1  A=(ARSD+3)
 IF A=1 THEN H+ GOTO T1E1D
 GOTO RMOVE
;
GGC   [HL [BC
 !VOP
 (GGC0+1)=SP SP=$FE00 HL=0
 DO B=160
 !(E5E5E5E5E5E5E5E5E5E5)
 !(E5E5E5E5E5E5E5E5E5E5)
 UNTIL DEC(B)=0
GGC0  SP=0
 !VCL
 ]BC ]HL
 RET
;
EDIT0 !("EDITOR COMMAND (1~5) ?"0D)
EDIT1 !("      1. EDIT"0D)
EDIT2 !("      2. DATA LOAD"0D)
EDIT3 !("      3. DATA SAVE"0D)
EDIT4 !("      4. DATA VERIFY"0D)
EDIT5 !("      5. END"0D)
;
EDIT  A=1 (CONST)=A (ED)=A
 DE=EDIT0 !$0889 !$0A2E
 DE=EDIT1 !$0889 !$0A2E
 DE=EDIT2 !$0889 !$0A2E
 DE=EDIT3 !$0889 !$0A2E
 DE=EDIT4 !$0889 !$0A2E
 DE=EDIT5 !$0889 !$0A2E
ED0   !VOP A=""
 ($D069)=A !VCL
 DO B=0
 !$0832
 IF A="1" GOTO EDITR
 IF A="2" GOTO LOAD
 IF A="3" GOTO SAVE
 IF A="4" GOTO VRFY
 IF A="5" GOTO DEMO
 UNTIL DEC(B)=0
 !VOP A=" "
 ($D069)=A !VCL
 DO B=0
 !$0832
 IF A="1" GOTO EDITR
 IF A="2" GOTO LOAD
 IF A="3" GOTO SAVE
 IF A="4" GOTO VRFY
 IF A="5" GOTO DEMO
 UNTIL DEC(B)=0
 GOTO ED0
;
EDITL !("** LOAD **"0D)
EDITS !("** SAVE **"0D)
EDITV !("** VERIFY **"0D)
EDITT !("Ã-Ìß ¦ ¾¯Ä ¼À× [CR] ¦ µ¼Ã¸ÀÞ»²¡"0D)
;
SAVE  DE=EDITS !$0889
 DE=EDITT !$0889 !$0A2E !$0A2E
SAVE0 !$0832 IF A<>13 GOTO SAVE0
 A=$34 ($1140)=A
 HL=SAVED DE=$1141 BC=17 LDIR
 HL=$6F54 ($1152)=HL
 HL=END+$4A38 ($1154)=HL
 HL=$12A0 ($1156)=HL
 !$0251 IF CY GOTO BREAK
 !$0282 IF CY GOTO BREAK
 GOTO EDIT
;
SAVED !("XETTER 2/data"0D0D0D0D)
SKIP  !("Skip "0D)
LING  !("Loading "0D)
VRFY3 !("Verifying "0D)
BRK   !("*Break"0D)
PUCR  !("Push [CR] key."0D)
OK    !("Ok !!"0D)
;
BREAK !$0A2E DE=BRK !$0889 !$0F14
BR2   !$0A2E DE=PUCR !$0889
BR1   !$0832 IF A<>13 GOTO BR1
 GOTO EDIT
;
LOAD  DE=EDITL !$0889
 DE=EDITT !$0889 !$0A2E !$0A2E
LOAD0 !$0832 IF A<>13 GOTO LOAD0
LOAD2 !$028E IF CY GOTO ERROR
 A=($1140) IF A<>$34 GOTO LOAD1
 HL=($1152) DE=$6F54 HL=HL-DE
 IF NZ GOTO LOAD1
 DE=$1141 HL=SAVED B=14
 !$063A IF NZ GOTO LOAD1
 DE=LING !$0889 DE=$1141 !$0889
 A=$21 ($02B9)=A HL=END+$4A38 ($02BA)=HL
 !$02B2 A=$2A ($02B9)=A HL=$1154 ($02BA)=HL
 IF CY THEN !DCLR GOTO ERROR
 GOTO EDIT
;
LOAD1 DE=SKIP !$0889 DE=$1141 !$0889 !$0A2E
 !$04B1 !$04CE IF CY GOTO ERROR
 !$0511 GOTO LOAD2
;
ERROR !$0562 IF Z GOTO BREAK
 !$0A2E !$0F14 GOTO BR2
;
VRFY  DE=EDITV !$0889
 DE=EDITT !$0889 !$0A2E !$0A2E
VRFY0 !$0832 IF A<>13 GOTO VRFY0
VRFY2 !$028E IF CY GOTO ERROR
 A=($1140) IF A<>$34 GOTO VRFY1
 HL=($1152) DE=$6F54 HL=HL-DE
 IF NZ GOTO VRFY1
 DE=$1141 HL=SAVED B=14
 !$063A IF NZ GOTO VRFY1
 DE=VRFY3 !$0889 DE=$1141 !$0889
 A=$21 ($02B9)=A HL=END+$4A38 ($02BA)=HL
 !$02BE A=$2A ($02B9)=A HL=$1154 ($02BA)=HL
 IF CY GOTO ERROR
 !$0A2E DE=OK !$0889 GOTO BR2
;
VRFY1 DE=SKIP !$0889 DE=$1141 !$0889 !$0A2E
 !$04B1 !$04CE IF CY GOTO ERROR
 !$0511 GOTO VRFY2
;
CURN  !(""0D)
CURF  !("    "0D)
;
EDT1  A=(MYX) RLC(A) A+ ($11D1)=A
 A=(MYY) RLC(A) A=A+4 ($11D2)=A
 DE=CURF !$0889
 RET
;
EDITR !VC DE=EDITD
 !$0889 !COSK9
EDT2  !S3
 A=1 (MYX)=A
EDT0  A=(MYX) RLC(A) A+ ($11D1)=A
 A=(MYY) RLC(A) A=A+4 ($11D2)=A
 DE=CURN !$0889
 DO B=0 !$0832
 IF A="2" GOTO CURD
 IF A="4" GOTO CURL
 IF A="6" GOTO CURR
 IF A="8" GOTO CURU
 IF A=" " GOTO CHR0
 IF A="Z" GOTO CHR4
 IF A="X" GOTO CHR5
 IF A="C" GOTO CHR2
 IF A="V" GOTO CHR1
 IF A="B" GOTO CHR3
 IF A="E" THEN !GC GOTO EDIT
 IF A="+" GOTO MENU
 IF A="-" GOTO MEND
 IF A="!" GOTO SCRCL
 UNTIL DEC(B)=0
 !EDT1
 DO B=0 !$0832
 IF A="2" GOTO CURD
 IF A="4" GOTO CURL
 IF A="6" GOTO CURR
 IF A="8" GOTO CURU
 IF A=" " GOTO CHR0
 IF A="Z" GOTO CHR4
 IF A="X" GOTO CHR5
 IF A="C" GOTO CHR2
 IF A="V" GOTO CHR1
 IF A="B" GOTO CHR3
 IF A="E" THEN !GC GOTO EDIT
 IF A="+" GOTO MENU
 IF A="-" GOTO MEND
 IF A="!" GOTO SCRCL
 UNTIL DEC(B)=0
 GOTO EDT0
;
CURD  !EDT1 A=(MYY) IF A=9 GOTO EDT0
 A+ (MYY)=A GOTO EDT0
;
CURR  !EDT1 A=(MYX) IF A=18 GOTO EDT0
 A+ (MYX)=A GOTO EDT0
;
CURU  !EDT1 A=(MYX) B=A A=(MYY)
 IF A=1 THEN IF B=0 GOTO EDT0
 IF A=0 GOTO EDT0
 A- (MYY)=A GOTO EDT0
;
CURL  !EDT1 A=(MYY) B=A A=(MYX)
 IF A=1 THEN IF B=0 GOTO EDT0
 IF A=0 GOTO EDT0
 A- (MYX)=A GOTO EDT0
;
MENU  A=(MEN) A+ IF A=251 THEN A=101
 (MEN)=A GOTO EDT2
;
MEND  A=(MEN) A- IF A=100 THEN A=250
 (MEN)=A GOTO EDT2
;
SCRCL !EDT1 A=0 (MYY)=A (GZ)=A A+ (MYX)=A
SCRC0 !MGET A=(MYX) RLC(A) (GX)=A
 A=(MYY) RLC(A) (GY)=A !PUT
 !MPUT0 A=" " (HL)=A
 A=(MYX) A+ (MYX)=A IF A<>19 GOTO SCRC0
 A=0 (MYX)=A
 A=(MYY) A+ (MYY)=A IF A<>10 GOTO SCRC0
 A=0 (MYY)=A A+ (MYX)=A
 GOTO EDT0
;
CHR0  !MGET A=(MYX) RLC(A) (GX)=A
 A=(MYY) RLC(A) (GY)=A
 A=0 (GZ)=A !PUT
 A=" " GOTO MPUT
;
MPUT  AF<>AF' !MPUT0
 AF<>AF' (HL)=A
 GOTO EDT0
;
CHR1  !MGET A=(MYX) RLC(A) (GX)=A
 A=(MYY) RLC(A) (GY)=A
 A=5 (GZ)=A !PUT
 A="5" GOTO MPUT
;
CHR2  CY=0 A=(CLR) A=A+4
 IF CY GOTO EDT0
 (CLR)=A !MGET
 A=(MYX) RLC(A) (GX)=A
 A=(MYY) RLC(A) (GY)=A
 A=4 (GZ)=A !PUT
 A="4" GOTO MPUT
;
CHR3  HL=IWA1-1 DO B=15 HL++ HL+
 A=(HL) IF A=0 THEN A+ (HL)=A GOTO CHR30
 UNTIL DEC(B)=0
 GOTO EDT0
CHR30 !MGET A=(MYX) RLC(A) (GX)=A A=(MYY)
 RLC(A) (GY)=A A=3 (GZ)=A !PUT
 A="3" GOTO MPUT
;
CHR4  HL=T11-1 DO B=4 HL++ HL+
 A=(HL) IF A=0 THEN A+ (HL)=A GOTO CHR40
 UNTIL DEC(B)=0
 GOTO EDT0
CHR40 !MGET A=(MYX) RLC(A) (GX)=A A=(MYY)
 RLC(A) (GY)=A A=1 (GZ)=A !PUT
 A="1" GOTO MPUT
;
CHR5  HL=T21-1 DO B=4 HL++ HL+
 A=(HL) IF A=0 THEN A+ (HL)=A GOTO CHR50
 UNTIL DEC(B)=0
 GOTO EDT0
CHR50 !MGET A=(MYX) RLC(A) (GX)=A A=(MYY)
 RLC(A) (GY)=A A=2 (GZ)=A !PUT
 A="2" GOTO MPUT
;
MPUT0 A=(MEN)
 HL=END-19 DE=190 A-
 DO B=A
 HL=HL+DE
 UNTIL DEC(B)=0
 A=(MYX) B=0 C=A HL=HL+BC
 A=(MYY) A+ DE=19
 DO B=A
 HL=HL+DE
 UNTIL DEC(B)=0
 RET
;
MGET  !MPUT0 A=(HL)
 IF A=" " RET
 IF A="5" RET
 IF A="4" THEN A=(CLR) A=A-4 (CLR)=A RET
 IF A="1" GOTO MGET0
 IF A="2" GOTO MGET1
 IF A<>"3" THEN HALT
 HL=IWA1+2 DO B=14 HL++ HL+
 A=(HL) IF A=0 THEN HL-- HL- GOTO MGET2
 UNTIL DEC(B)=0
MGET2 A=0 (HL)=A RET
;
MGET0 HL=T11+2 DO B=3 HL++ HL+
 A=(HL) IF A=0 THEN HL-- HL- GOTO MGET2
 UNTIL DEC(B)=0
 GOTO MGET2
;
MGET1 HL=T21+2 DO B=3 HL++ HL+
 A=(HL) IF A=0 THEN HL-- HL- GOTO MGET2
 UNTIL DEC(B)=0
 GOTO MGET2
;
 !("* K.Kuromusha Original No.12 *")
;
END
